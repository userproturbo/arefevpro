- name: Deploy via SSH
  run: |
    ssh -T ${{ secrets.VPS_USER }}@${{ secrets.VPS_HOST }} << 'EOF'
      set -e

      cd /home/${{ secrets.VPS_USER }}/arefevpro

      echo "== Fetch & reset to main =="
      git fetch origin
      git reset --hard origin/main

      echo "== Install dependencies =="
      npm install

      echo "== Prisma generate =="
      npx prisma generate

      echo "== Build Next.js =="
      npm run build

      echo "== Restart PM2 =="
      pm2 reload ecosystem.config.js --update-env || pm2 start ecosystem.config.js

      echo "== Deploy finished successfully =="
    EOF
